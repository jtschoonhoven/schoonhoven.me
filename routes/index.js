
/*
 * GET home page.
 */

exports.index = function(req, res){
  res.render('index', { 
    tableObj: JSON.stringify({
      "reach_report": {"name":"reach_report","title":"Reach Report","created_at":"2013-12-23","description":"Number of emails received by eligible users over the last 30 days","chartType":"table","location":"./queries/reach_report.sql","query":"SELECT\n  country\n, SUM(CASE WHEN aas_received  = 0  THEN 1 ELSE 0 END) AS _0\n, SUM(CASE WHEN aas_received  = 1  THEN 1 ELSE 0 END) AS _1\n, SUM(CASE WHEN aas_received  = 2  THEN 1 ELSE 0 END) AS _2\n, SUM(CASE WHEN aas_received  = 3  THEN 1 ELSE 0 END) AS _3\n, SUM(CASE WHEN aas_received  = 4  THEN 1 ELSE 0 END) AS _4\n, SUM(CASE WHEN aas_received  = 5  THEN 1 ELSE 0 END) AS _5\n, SUM(CASE WHEN aas_received  = 6  THEN 1 ELSE 0 END) AS _6\n, SUM(CASE WHEN aas_received  = 7  THEN 1 ELSE 0 END) AS _7\n, SUM(CASE WHEN aas_received  = 8  THEN 1 ELSE 0 END) AS _8\n, SUM(CASE WHEN aas_received  = 9  THEN 1 ELSE 0 END) AS _9\n, SUM(CASE WHEN aas_received  = 10 THEN 1 ELSE 0 END) AS _10\n, SUM(CASE WHEN aas_received  = 11 THEN 1 ELSE 0 END) AS _11\n, SUM(CASE WHEN aas_received  = 12 THEN 1 ELSE 0 END) AS _12\n, SUM(CASE WHEN aas_received  = 13 THEN 1 ELSE 0 END) AS _13\n, SUM(CASE WHEN aas_received  = 14 THEN 1 ELSE 0 END) AS _14\n, SUM(CASE WHEN aas_received  = 15 THEN 1 ELSE 0 END) AS _15\n, SUM(CASE WHEN aas_received  = 16 THEN 1 ELSE 0 END) AS _16\n, SUM(CASE WHEN aas_received  = 17 THEN 1 ELSE 0 END) AS _17\n, SUM(CASE WHEN aas_received  = 18 THEN 1 ELSE 0 END) AS _18\n, SUM(CASE WHEN aas_received  = 19 THEN 1 ELSE 0 END) AS _19\n, SUM(CASE WHEN aas_received >= 20 THEN 1 ELSE 0 END) AS _20\nFROM (\n  SELECT el.id AS user_id, u.country, COUNT(iar.unique_id) AS aas_received\n  FROM eligible_users el\n  JOIN users u ON u.id = el.id\n  LEFT JOIN individual_alert_records iar ON iar.user_id = el.id\n  WHERE u.country IN ('US', 'CA', 'DE', 'ES', 'FR', 'GB', 'IT', 'BY', 'RU', 'TR', 'UA', 'AR', 'BR', 'MX', 'AU', 'IN', 'JP', 'PH', 'TH', 'ID')\n  AND u.created_at < CURRENT_DATE - INTERVAL '30 DAYS'\n  AND (iar.created_at >= CURRENT_DATE - INTERVAL '30 DAYS' OR iar.created_at IS NULL)\n  GROUP BY el.id, u.country\n  )\nGROUP BY country\nORDER BY country;","rows":[[{"name":"country","value":"AR"},{"name":"_0","value":"3019"},{"name":"_1","value":"1605"},{"name":"_2","value":"1767"},{"name":"_3","value":"183494"},{"name":"_4","value":"178013"},{"name":"_5","value":"239995"},{"name":"_6","value":"61921"},{"name":"_7","value":"45268"},{"name":"_8","value":"19242"},{"name":"_9","value":"9561"},{"name":"_10","value":"3359"},{"name":"_11","value":"1468"},{"name":"_12","value":"267"},{"name":"_13","value":"17"},{"name":"_14","value":"1"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"AU"},{"name":"_0","value":"2149"},{"name":"_1","value":"2962"},{"name":"_2","value":"105896"},{"name":"_3","value":"219285"},{"name":"_4","value":"197612"},{"name":"_5","value":"230449"},{"name":"_6","value":"141330"},{"name":"_7","value":"77731"},{"name":"_8","value":"39536"},{"name":"_9","value":"18776"},{"name":"_10","value":"7269"},{"name":"_11","value":"2752"},{"name":"_12","value":"648"},{"name":"_13","value":"80"},{"name":"_14","value":"8"},{"name":"_15","value":"2"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"BR"},{"name":"_0","value":"1189"},{"name":"_1","value":"13116"},{"name":"_2","value":"328437"},{"name":"_3","value":"478358"},{"name":"_4","value":"218841"},{"name":"_5","value":"112085"},{"name":"_6","value":"9309"},{"name":"_7","value":"172"},{"name":"_8","value":"0"},{"name":"_9","value":"1"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"BY"},{"name":"_0","value":"268"},{"name":"_1","value":"1315"},{"name":"_2","value":"118989"},{"name":"_3","value":"4336"},{"name":"_4","value":"27"},{"name":"_5","value":"3"},{"name":"_6","value":"3"},{"name":"_7","value":"0"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"CA"},{"name":"_0","value":"1333"},{"name":"_1","value":"2954"},{"name":"_2","value":"4057"},{"name":"_3","value":"135115"},{"name":"_4","value":"504663"},{"name":"_5","value":"327415"},{"name":"_6","value":"103900"},{"name":"_7","value":"10128"},{"name":"_8","value":"52"},{"name":"_9","value":"0"},{"name":"_10","value":"2"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"DE"},{"name":"_0","value":"1362"},{"name":"_1","value":"1123"},{"name":"_2","value":"85383"},{"name":"_3","value":"395730"},{"name":"_4","value":"375864"},{"name":"_5","value":"206016"},{"name":"_6","value":"54449"},{"name":"_7","value":"21104"},{"name":"_8","value":"8468"},{"name":"_9","value":"2853"},{"name":"_10","value":"600"},{"name":"_11","value":"62"},{"name":"_12","value":"4"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"ES"},{"name":"_0","value":"2986"},{"name":"_1","value":"2598"},{"name":"_2","value":"4210"},{"name":"_3","value":"97392"},{"name":"_4","value":"522717"},{"name":"_5","value":"885111"},{"name":"_6","value":"750572"},{"name":"_7","value":"293603"},{"name":"_8","value":"94725"},{"name":"_9","value":"31044"},{"name":"_10","value":"6159"},{"name":"_11","value":"588"},{"name":"_12","value":"29"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"1"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"FR"},{"name":"_0","value":"2452"},{"name":"_1","value":"2399"},{"name":"_2","value":"2019"},{"name":"_3","value":"520050"},{"name":"_4","value":"744727"},{"name":"_5","value":"210993"},{"name":"_6","value":"74955"},{"name":"_7","value":"30700"},{"name":"_8","value":"9318"},{"name":"_9","value":"2370"},{"name":"_10","value":"242"},{"name":"_11","value":"30"},{"name":"_12","value":"2"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"GB"},{"name":"_0","value":"3656"},{"name":"_1","value":"4809"},{"name":"_2","value":"15171"},{"name":"_3","value":"62164"},{"name":"_4","value":"620665"},{"name":"_5","value":"779573"},{"name":"_6","value":"279882"},{"name":"_7","value":"107495"},{"name":"_8","value":"72801"},{"name":"_9","value":"41627"},{"name":"_10","value":"24394"},{"name":"_11","value":"17013"},{"name":"_12","value":"12485"},{"name":"_13","value":"8903"},{"name":"_14","value":"5950"},{"name":"_15","value":"3360"},{"name":"_16","value":"1356"},{"name":"_17","value":"347"},{"name":"_18","value":"53"},{"name":"_19","value":"8"},{"name":"_20","value":"1"}],[{"name":"country","value":"ID"},{"name":"_0","value":"668"},{"name":"_1","value":"435"},{"name":"_2","value":"552"},{"name":"_3","value":"12627"},{"name":"_4","value":"93910"},{"name":"_5","value":"54377"},{"name":"_6","value":"8780"},{"name":"_7","value":"720"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"IN"},{"name":"_0","value":"537"},{"name":"_1","value":"450"},{"name":"_2","value":"743"},{"name":"_3","value":"4143"},{"name":"_4","value":"293476"},{"name":"_5","value":"160132"},{"name":"_6","value":"14598"},{"name":"_7","value":"766"},{"name":"_8","value":"9"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"IT"},{"name":"_0","value":"1261"},{"name":"_1","value":"2636"},{"name":"_2","value":"4288"},{"name":"_3","value":"41274"},{"name":"_4","value":"325877"},{"name":"_5","value":"775611"},{"name":"_6","value":"90358"},{"name":"_7","value":"30362"},{"name":"_8","value":"11142"},{"name":"_9","value":"3328"},{"name":"_10","value":"744"},{"name":"_11","value":"61"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"JP"},{"name":"_0","value":"293"},{"name":"_1","value":"428"},{"name":"_2","value":"1286"},{"name":"_3","value":"14978"},{"name":"_4","value":"54753"},{"name":"_5","value":"47008"},{"name":"_6","value":"4244"},{"name":"_7","value":"1"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"MX"},{"name":"_0","value":"890"},{"name":"_1","value":"298752"},{"name":"_2","value":"333534"},{"name":"_3","value":"159399"},{"name":"_4","value":"42353"},{"name":"_5","value":"2034"},{"name":"_6","value":"93"},{"name":"_7","value":"6"},{"name":"_8","value":"3"},{"name":"_9","value":"3"},{"name":"_10","value":"0"},{"name":"_11","value":"1"},{"name":"_12","value":"1"},{"name":"_13","value":"1"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"PH"},{"name":"_0","value":"326"},{"name":"_1","value":"213"},{"name":"_2","value":"117"},{"name":"_3","value":"271"},{"name":"_4","value":"55296"},{"name":"_5","value":"48920"},{"name":"_6","value":"21321"},{"name":"_7","value":"5497"},{"name":"_8","value":"1609"},{"name":"_9","value":"323"},{"name":"_10","value":"31"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"RU"},{"name":"_0","value":"1541"},{"name":"_1","value":"85658"},{"name":"_2","value":"817720"},{"name":"_3","value":"314168"},{"name":"_4","value":"28308"},{"name":"_5","value":"2004"},{"name":"_6","value":"162"},{"name":"_7","value":"6"},{"name":"_8","value":"1"},{"name":"_9","value":"1"},{"name":"_10","value":"0"},{"name":"_11","value":"1"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"TH"},{"name":"_0","value":"7574"},{"name":"_1","value":"1107"},{"name":"_2","value":"1648"},{"name":"_3","value":"706896"},{"name":"_4","value":"20"},{"name":"_5","value":"14"},{"name":"_6","value":"2"},{"name":"_7","value":"1"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"TR"},{"name":"_0","value":"1138"},{"name":"_1","value":"1659"},{"name":"_2","value":"1792"},{"name":"_3","value":"94272"},{"name":"_4","value":"444798"},{"name":"_5","value":"15822"},{"name":"_6","value":"7030"},{"name":"_7","value":"15"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"UA"},{"name":"_0","value":"230"},{"name":"_1","value":"837"},{"name":"_2","value":"323"},{"name":"_3","value":"816"},{"name":"_4","value":"119500"},{"name":"_5","value":"49499"},{"name":"_6","value":"235"},{"name":"_7","value":"0"},{"name":"_8","value":"0"},{"name":"_9","value":"0"},{"name":"_10","value":"0"},{"name":"_11","value":"0"},{"name":"_12","value":"0"},{"name":"_13","value":"0"},{"name":"_14","value":"0"},{"name":"_15","value":"0"},{"name":"_16","value":"0"},{"name":"_17","value":"0"},{"name":"_18","value":"0"},{"name":"_19","value":"0"},{"name":"_20","value":"0"}],[{"name":"country","value":"US"},{"name":"_0","value":"1651"},{"name":"_1","value":"47246"},{"name":"_2","value":"202190"},{"name":"_3","value":"1618236"},{"name":"_4","value":"1942442"},{"name":"_5","value":"898124"},{"name":"_6","value":"505401"},{"name":"_7","value":"336159"},{"name":"_8","value":"279330"},{"name":"_9","value":"239755"},{"name":"_10","value":"188486"},{"name":"_11","value":"145064"},{"name":"_12","value":"121020"},{"name":"_13","value":"140431"},{"name":"_14","value":"479240"},{"name":"_15","value":"222381"},{"name":"_16","value":"83378"},{"name":"_17","value":"33251"},{"name":"_18","value":"9672"},{"name":"_19","value":"1885"},{"name":"_20","value":"247"}]]},
      "sign_dist": {"name":"sign_dist","title":"Distribution of Total Signatures","created_at":"2013-12-23","description":"tbd","chartType":"table","location":"./queries/sign_dist.sql","query":"SELECT \n  u.country\n, SUM(CASE WHEN e.total_signature_count BETWEEN 0      AND 100     THEN 1 ELSE 0 END) AS _1\n, SUM(CASE WHEN e.total_signature_count BETWEEN 101    AND 1000    THEN 1 ELSE 0 END) AS _2\n, SUM(CASE WHEN e.total_signature_count BETWEEN 1001   AND 10000   THEN 1 ELSE 0 END) AS _3\n, SUM(CASE WHEN e.total_signature_count BETWEEN 10001  AND 100000  THEN 1 ELSE 0 END) AS _4\n, SUM(CASE WHEN e.total_signature_count BETWEEN 100001 AND 1000000 THEN 1 ELSE 0 END) AS _5\n, SUM(CASE WHEN e.total_signature_count       > 1000000            THEN 1 ELSE 0 END) AS _6\nFROM events e\nJOIN users u ON u.id = e.user_id\nWHERE e.status > 0\nAND e.created_at >= CURRENT_DATE - INTERVAL '1 YEAR'\nAND u.country IN ('US', 'CA', 'DE', 'ES', 'FR', 'GB', 'IT', 'BY', 'RU')\nGROUP BY u.country\nORDER BY u.country;","rows":[[{"name":"country","value":"BY"},{"name":"_1","value":"415"},{"name":"_2","value":"41"},{"name":"_3","value":"23"},{"name":"_4","value":"5"},{"name":"_5","value":"0"},{"name":"_6","value":"0"}],[{"name":"country","value":"CA"},{"name":"_1","value":"9060"},{"name":"_2","value":"863"},{"name":"_3","value":"275"},{"name":"_4","value":"35"},{"name":"_5","value":"3"},{"name":"_6","value":"0"}],[{"name":"country","value":"DE"},{"name":"_1","value":"4667"},{"name":"_2","value":"436"},{"name":"_3","value":"219"},{"name":"_4","value":"68"},{"name":"_5","value":"2"},{"name":"_6","value":"0"}],[{"name":"country","value":"ES"},{"name":"_1","value":"33398"},{"name":"_2","value":"2701"},{"name":"_3","value":"836"},{"name":"_4","value":"204"},{"name":"_5","value":"34"},{"name":"_6","value":"1"}],[{"name":"country","value":"FR"},{"name":"_1","value":"10765"},{"name":"_2","value":"866"},{"name":"_3","value":"297"},{"name":"_4","value":"100"},{"name":"_5","value":"4"},{"name":"_6","value":"0"}],[{"name":"country","value":"GB"},{"name":"_1","value":"17084"},{"name":"_2","value":"1545"},{"name":"_3","value":"514"},{"name":"_4","value":"104"},{"name":"_5","value":"12"},{"name":"_6","value":"0"}],[{"name":"country","value":"IT"},{"name":"_1","value":"11071"},{"name":"_2","value":"868"},{"name":"_3","value":"281"},{"name":"_4","value":"101"},{"name":"_5","value":"6"},{"name":"_6","value":"0"}],[{"name":"country","value":"RU"},{"name":"_1","value":"5934"},{"name":"_2","value":"428"},{"name":"_3","value":"173"},{"name":"_4","value":"45"},{"name":"_5","value":"4"},{"name":"_6","value":"0"}],[{"name":"country","value":"US"},{"name":"_1","value":"96953"},{"name":"_2","value":"8138"},{"name":"_3","value":"2325"},{"name":"_4","value":"513"},{"name":"_5","value":"87"},{"name":"_6","value":"0"}]]}
    })
  });
};